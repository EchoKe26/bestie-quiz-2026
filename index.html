<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>2026年度闺蜜默契大测试</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  overflow: hidden;
  touch-action: manipulation;
  -webkit-user-select: none;
  user-select: none;
}

.stage { display: none; width: 100vw; min-height: 100vh; position: absolute; top: 0; left: 0; }
.stage.active { display: flex; flex-direction: column; align-items: center; justify-content: center; }

#stage0 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
.invite-box {
  background: white; border-radius: 20px; padding: 30px 25px; width: 85%; max-width: 360px;
  text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  animation: floatIn 0.8s ease-out;
}
.invite-box h1 { font-size: 22px; color: #333; margin-bottom: 8px; }
.invite-box .subtitle { color: #888; font-size: 13px; margin-bottom: 20px; }
.invite-box .hearts { font-size: 40px; margin-bottom: 15px; animation: heartbeat 1s infinite; }
.invite-box .desc { font-size: 14px; color: #555; line-height: 1.8; margin-bottom: 20px; }
.invite-box .highlight { color: #f5576c; font-weight: bold; }
.start-btn {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  color: white; border: none; padding: 14px 50px; border-radius: 30px;
  font-size: 16px; font-weight: bold; cursor: pointer;
  animation: pulse 2s infinite;
  -webkit-tap-highlight-color: transparent;
}

#stage1 { background: #0a0a2e; }
.scan-container { text-align: center; color: white; }
.scan-circle {
  width: 180px; height: 180px; border-radius: 50%;
  border: 3px solid #00ff88; margin: 0 auto 30px;
  position: relative; overflow: hidden;
  animation: scanPulse 2s infinite;
}
.scan-circle::after {
  content: ''; position: absolute; top: 0; left: 0; right: 0;
  height: 3px; background: #00ff88;
  animation: scanLine 2s infinite linear;
  box-shadow: 0 0 20px #00ff88;
}
.scan-emoji { font-size: 80px; line-height: 180px; }
.scan-text { font-size: 16px; color: #00ff88; margin-bottom: 10px; }
.scan-detail { font-size: 12px; color: #666; }
.progress-bar {
  width: 200px; height: 6px; background: #1a1a4e; border-radius: 3px;
  margin: 20px auto; overflow: hidden;
}
.progress-fill {
  height: 100%; background: linear-gradient(90deg, #00ff88, #00ccff);
  border-radius: 3px; width: 0%; transition: width 0.3s;
}

#stage2 { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); padding: 40px 20px; }
.question-card {
  background: white; border-radius: 20px; padding: 25px 20px; width: 90%; max-width: 380px;
  text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}
.q-number { font-size: 12px; color: #a18cd1; margin-bottom: 5px; }
.q-title { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 20px; }
.option-btn {
  display: block; width: 100%; padding: 14px; margin-bottom: 12px;
  border: 2px solid #e0e0e0; border-radius: 12px;
  background: white; font-size: 15px; color: #333; cursor: pointer;
  position: relative; transition: all 0.3s;
  -webkit-tap-highlight-color: transparent;
}
.option-btn:active { border-color: #a18cd1; background: #f8f0ff; }
.dodge-hint {
  font-size: 12px; color: #ff6b6b; margin-top: 5px;
  opacity: 0; transition: opacity 0.5s;
}
.dodge-hint.show { opacity: 1; }

#stage3 { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); padding: 40px 20px; }
#stage4 { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); padding: 40px 20px; }

#stage5 {
  background: linear-gradient(135deg, #f5576c 0%, #ff6b6b 50%, #feca57 100%);
  padding: 20px; overflow-y: auto;
}
.result-card {
  background: white; border-radius: 20px; padding: 25px 20px; width: 90%; max-width: 380px;
  text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  animation: resultBounce 0.8s ease-out;
  margin: auto;
}
.result-title { font-size: 14px; color: #999; margin-bottom: 5px; }
.result-name {
  font-size: 28px; font-weight: bold; color: #f5576c;
  margin-bottom: 5px; animation: rainbow 2s infinite;
}
.result-badge {
  display: inline-block; background: #f5576c; color: white;
  padding: 4px 15px; border-radius: 20px; font-size: 12px; margin-bottom: 15px;
}
.result-avatar { font-size: 80px; margin-bottom: 15px; animation: spin 3s infinite linear; }
.result-desc {
  font-size: 14px; color: #666; line-height: 1.8; margin-bottom: 15px;
  text-align: left; padding: 0 10px;
}
.result-stats {
  display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px;
}
.stat-item { text-align: center; }
.stat-value { font-size: 22px; font-weight: bold; color: #f5576c; }
.stat-label { font-size: 11px; color: #999; }
.close-btn {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white; border: none; padding: 14px 40px; border-radius: 30px;
  font-size: 16px; cursor: pointer; margin-top: 10px;
  -webkit-tap-highlight-color: transparent;
}
.close-btn:active { transform: scale(0.95); }

.danmu {
  position: fixed; white-space: nowrap; font-size: 14px;
  color: rgba(255,255,255,0.9); pointer-events: none; z-index: 100;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
  font-weight: bold;
}

.confetti {
  position: fixed; width: 10px; height: 10px; z-index: 99; pointer-events: none;
  animation: confettiFall 3s linear forwards;
}

.shake-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(255,0,0,0.3); z-index: 200; display: none;
  animation: flashBg 0.5s;
}

.fake-close {
  position: fixed; top: 15px; right: 15px; width: 32px; height: 32px;
  background: rgba(0,0,0,0.3); border-radius: 50%; z-index: 50;
  display: flex; align-items: center; justify-content: center;
  color: white; font-size: 18px; cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

@keyframes floatIn {
  from { opacity: 0; transform: translateY(30px) scale(0.9); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes heartbeat {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}
@keyframes pulse {
  0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(245,87,108,0.4); }
  50% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(245,87,108,0); }
}
@keyframes scanPulse {
  0%, 100% { box-shadow: 0 0 20px rgba(0,255,136,0.3); }
  50% { box-shadow: 0 0 40px rgba(0,255,136,0.6); }
}
@keyframes scanLine { 0% { top: 0; } 100% { top: 100%; } }
@keyframes resultBounce {
  0% { opacity: 0; transform: scale(0.3) rotate(-10deg); }
  50% { transform: scale(1.1) rotate(3deg); }
  100% { opacity: 1; transform: scale(1) rotate(0deg); }
}
@keyframes rainbow {
  0% { color: #f5576c; } 25% { color: #feca57; }
  50% { color: #48dbfb; } 75% { color: #ff9ff3; } 100% { color: #f5576c; }
}
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes confettiFall {
  0% { opacity: 1; transform: translateY(0) rotate(0deg); }
  100% { opacity: 0; transform: translateY(100vh) rotate(720deg); }
}
@keyframes flashBg { 0%, 100% { opacity: 0; } 50% { opacity: 1; } }
@keyframes shakeIt {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
  20%, 40%, 60%, 80% { transform: translateX(5px); }
}
.shaking { animation: shakeIt 0.5s; }
</style>
</head>
<body>

<div class="fake-close" id="fakeClose" onclick="fakeCloseClick()">&#x2715;</div>
<div class="shake-overlay" id="shakeOverlay"></div>

<!-- 阶段0: 入口 -->
<div class="stage active" id="stage0">
  <div class="invite-box">
    <div class="hearts">&#x1F495;&#x1F497;&#x1F495;</div>
    <h1>2026年度闺蜜默契测试</h1>
    <div class="subtitle">&#x1F525; 全网已有 2,847,391 人参与</div>
    <div class="desc">
      你的好闺蜜邀请你完成这份<span class="highlight">灵魂拷问</span><br>
      据说只有<span class="highlight">真正了解自己</span>的人<br>
      才能通过全部测试哦~<br><br>
      &#x26A0;&#xFE0F; <span style="font-size:12px;color:#999;">本测试由「国际友谊鉴定中心」认证</span>
    </div>
    <button class="start-btn" onclick="startTest()">&#x1F44B; 开始测试</button>
  </div>
</div>

<!-- 阶段1: 假扫描 -->
<div class="stage" id="stage1">
  <div class="scan-container">
    <div class="scan-circle">
      <div class="scan-emoji">&#x1F9D0;</div>
    </div>
    <div class="scan-text" id="scanText">正在连接卫星...</div>
    <div class="scan-detail" id="scanDetail">请保持手机不动</div>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>
</div>

<!-- 阶段2: 第一题 -->
<div class="stage" id="stage2">
  <div class="question-card">
    <div class="q-number">&#x1F4CB; 第 1 题 / 共 3 题</div>
    <div class="q-title">你觉得自己属于哪种气质？</div>
    <button class="option-btn" id="opt1a" ontouchstart="dodgeBtn(this)" onclick="dodgeBtn(this)">A. 冷艳高贵·白富美</button>
    <button class="option-btn" id="opt1b" ontouchstart="dodgeBtn(this)" onclick="dodgeBtn(this)">B. 温柔知性·大才女</button>
    <button class="option-btn" id="opt1c" ontouchstart="dodgeBtn(this)" onclick="dodgeBtn(this)">C. 甜美可爱·小仙女</button>
    <button class="option-btn" id="opt1d" onclick="pickAbstract(3)">D. 厕所蹲坑·刷手机</button>
    <div class="dodge-hint" id="hint2">&#x1F446; 别挣扎了 就选D吧</div>
  </div>
</div>

<!-- 阶段3: 第二题 -->
<div class="stage" id="stage3">
  <div class="question-card">
    <div class="q-number">&#x1F4CB; 第 2 题 / 共 3 题</div>
    <div class="q-title">朋友们怎么形容你？</div>
    <button class="option-btn" id="opt2a" ontouchstart="dodgeBtn(this)" onclick="dodgeBtn(this)">A. 人美心善·大方得体</button>
    <button class="option-btn" id="opt2b" ontouchstart="dodgeBtn(this)" onclick="dodgeBtn(this)">B. 独立自信·霸气侧漏</button>
    <button class="option-btn" id="opt2c" onclick="pickAbstract(4)">C. 行走的表情包·社死担当</button>
    <button class="option-btn" id="opt2d" ontouchstart="dodgeBtn(this)" onclick="dodgeBtn(this)">D. 善解人意·贴心暖宝</button>
    <div class="dodge-hint" id="hint3">&#x1F937; 命运已经帮你选好了</div>
  </div>
</div>

<!-- 阶段4: 第三题 -->
<div class="stage" id="stage4">
  <div class="question-card">
    <div class="q-number">&#x1F4CB; 第 3 题 / 共 3 题 (最后一题!)</div>
    <div class="q-title">选一个词形容你的人生态度</div>
    <button class="option-btn" id="opt3a" ontouchstart="dodgeBtn(this)" onclick="dodgeBtn(this)">A. 岁月静好·优雅从容</button>
    <button class="option-btn" id="opt3b" onclick="pickAbstract(5)">B. 九炸姐·抽象派掌门人</button>
    <button class="option-btn" id="opt3c" ontouchstart="dodgeBtn(this)" onclick="dodgeBtn(this)">C. 乘风破浪·勇往直前</button>
    <button class="option-btn" id="opt3d" ontouchstart="dodgeBtn(this)" onclick="dodgeBtn(this)">D. 精致生活·品味不凡</button>
    <div class="dodge-hint" id="hint4">&#x1F449; 你逃不掉的 认命吧哈哈哈</div>
  </div>
</div>

<!-- 阶段5: 结果页 -->
<div class="stage" id="stage5">
  <div class="result-card">
    <div class="result-title">&#x1F3C6; 2026闺蜜鉴定报告 &#x1F3C6;</div>
    <div class="result-avatar">&#x1F479;</div>
    <div class="result-name">&#x300E; 九炸姐 &#x300F;</div>
    <div class="result-badge">&#x1F4A3; 抽象派·终身成就奖</div>
    <div class="result-desc">
      &#x1F50D; <b>AI深度分析报告：</b><br><br>
      &#x2022; 经过三轮灵魂拷问，系统检测到你的<b>抽象浓度高达99.8%</b>，已超越全国99.9%的用户<br><br>
      &#x2022; 你的精神状态被鉴定为：<b>「清醒的疯癫·优雅的发疯」</b><br><br>
      &#x2022; 建议职业方向：<b>互联网抽象艺术家 / 表情包生产总监 / 社死体验官</b><br><br>
      &#x2022; 博士哥评价：<b>「这位九炸姐 前端都不用学了 直接抽象就完事」</b>&#x1F923;<br><br>
      &#x26A0;&#xFE0F; <span style="color:#f5576c;font-weight:bold;">本结果已自动同步到朋友圈（骗你的&#x1F92A;）</span>
    </div>
    <div class="result-stats">
      <div class="stat-item">
        <div class="stat-value">99.8%</div>
        <div class="stat-label">抽象指数</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">MAX</div>
        <div class="stat-label">社死等级</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">&#x267E;&#xFE0F;</div>
        <div class="stat-label">搞笑天赋</div>
      </div>
    </div>
    <button class="close-btn" onclick="realClose()">&#x1F62D; 我承认我是九炸姐 关闭</button>
    <div style="margin-top:10px;font-size:11px;color:#ccc;">* 点击上方按钮承认后方可关闭 *</div>
  </div>
</div>

<script>
let dodgeCount = 0;
let fakeCloseCount = 0;
let currentStage = 0;
let danmuTimer = null;

const danmuTexts = [
  '博士哥: 这人抽象浓度爆表了',
  '九炸姐就是你!',
  '前端大佬: 看不下去了',
  '博士哥: 带不动 真的带不动',
  '哈哈哈哈哈选不到吧',
  '博士哥带我飞!!!',
  '九炸姐冲冲冲!',
  '前端大佬已阵亡',
  '认命吧姐妹 你就是抽象人',
  '博士哥: 我直接笑出声',
  '命运的齿轮开始转动',
  '前端大佬: 这个bug修不了',
  '你已经被包围了!',
  '九炸姐威武!',
  '博士哥: 抽象浓度检测中...',
  '放弃挣扎! 投降吧!',
  '前端大佬: 建议重开',
  '太好笑了 博士哥都看不下去了',
  '你完了你知道吗',
  '哈哈哈哈哈哈哈哈哈',
  '系统提示: 九炸姐已上线',
  '逃不掉的~',
  '社死倒计时 3 2 1...',
  '全网都在看你选',
  '博士哥: 她怎么还在挣扎',
  '前端大佬带我飞!',
  '九炸姐: 我不是 我没有',
  '博士哥: 别解释了 越描越黑',
  '前端大佬: 代码都比她聪明',
  '博士哥直呼内行',
  '九炸姐的抽象之路',
  '有没有大佬带带我',
  '前端大佬: 这页面就是为你做的',
  '博士哥: respect!',
  '九炸姐 你是我见过最抽象的',
  '前端大佬已退出群聊',
  '博士哥: 笑死 根本点不到',
  '带我飞带我飞带我飞!!!',
  '九炸姐天下第一!',
  '博士哥: 建议直接封神',
];

function showStage(n) {
  document.querySelectorAll('.stage').forEach(s => s.classList.remove('active'));
  document.getElementById('stage' + n).classList.add('active');
  currentStage = n;
}

function startTest() {
  showStage(1);
  runScan();
  // 扫描阶段就开始弹幕
  startDanmuLoop();
}

// 持续弹幕循环
function startDanmuLoop() {
  if (danmuTimer) return;
  danmuTimer = setInterval(() => {
    launchDanmu();
    // 随机多发一条
    if (Math.random() > 0.4) {
      setTimeout(() => launchDanmu(), 200 + Math.random() * 500);
    }
    // 偶尔连发三条
    if (Math.random() > 0.7) {
      setTimeout(() => launchDanmu(), 400 + Math.random() * 300);
    }
  }, 800);
}

function runScan() {
  const steps = [
    { text: '正在连接卫星...', detail: 'GPS定位中', pct: 10 },
    { text: '正在扫描你的WiFi...', detail: '发现可疑信号', pct: 20 },
    { text: '正在分析你的手机壳颜色...', detail: '检测到粉色', pct: 30 },
    { text: '正在读取你的表情包数量...', detail: '已发现8,431张', pct: 45 },
    { text: '正在偷看你的聊天记录...', detail: '(骗你的别慌)', pct: 55 },
    { text: '正在计算你的颜值...', detail: '数据溢出!', pct: 65 },
    { text: '正在鉴定你的抽象浓度...', detail: '警告: 浓度过高!', pct: 78 },
    { text: '正在联系博士哥确认...', detail: '博士哥: 确认是抽象人', pct: 88 },
    { text: '扫描完成!', detail: '结果可能引起极度不适...', pct: 100 },
  ];
  let i = 0;
  const interval = setInterval(() => {
    if (i >= steps.length) {
      clearInterval(interval);
      setTimeout(() => showStage(2), 800);
      return;
    }
    document.getElementById('scanText').textContent = steps[i].text;
    document.getElementById('scanDetail').textContent = steps[i].detail;
    document.getElementById('progressFill').style.width = steps[i].pct + '%';
    i++;
  }, 700);
}

// 判断是不是该跑路的按钮
function isCorrectBtn(btn) {
  return btn.id === 'opt1d' || btn.id === 'opt2c' || btn.id === 'opt3b';
}

function dodgeBtn(btn) {
  // 正确选项不跑路
  if (isCorrectBtn(btn)) return;

  dodgeCount++;

  const btnRect = btn.getBoundingClientRect();
  let newX, newY;
  for (let t = 0; t < 10; t++) {
    newX = (Math.random() - 0.5) * 220;
    newY = (Math.random() - 0.5) * 160;
    const futureLeft = btnRect.left + newX;
    const futureTop = btnRect.top + newY;
    if (futureLeft > -50 && futureLeft < window.innerWidth - 50 &&
        futureTop > 50 && futureTop < window.innerHeight - 50) break;
  }

  btn.style.transition = 'transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
  btn.style.transform = `translate(${newX}px, ${newY}px) rotate(${(Math.random()-0.5)*30}deg)`;

  const funTexts = [
    '你点不到我~', '略略略~', '就不让你选!', '哈哈追不上吧',
    '我跑~', '嘿嘿嘿', '别做梦了', '想得美!', '再见~', '拜拜~',
    '太慢了!', '你手速不行啊', '博士哥说你不配选我', '九炸姐别闹了',
    '前端大佬都看笑了', '带你飞? 先选对吧!', '你在逗我?',
  ];
  btn.textContent = funTexts[Math.floor(Math.random() * funTexts.length)];

  document.body.classList.add('shaking');
  setTimeout(() => document.body.classList.remove('shaking'), 500);

  // 每次点错都发弹幕
  launchDanmu();
  if (dodgeCount % 2 === 0) launchDanmu();

  // 显示提示
  const stageNum = parseInt(btn.closest('.stage').id.replace('stage', ''));
  const hint = document.getElementById('hint' + stageNum);
  if (hint && dodgeCount >= 3) hint.classList.add('show');

  if (dodgeCount > 6) {
    setTimeout(() => {
      btn.style.opacity = '0.3';
      btn.style.fontSize = '10px';
    }, 300);
  }
}

function pickAbstract(nextStage) {
  if (navigator.vibrate) navigator.vibrate(50);
  dodgeCount = 0;

  const overlay = document.getElementById('shakeOverlay');
  overlay.style.display = 'block';
  overlay.style.background = 'rgba(255,107,107,0.3)';
  setTimeout(() => overlay.style.display = 'none', 300);

  // 选对了也发一波弹幕嘲讽
  for (let i = 0; i < 5; i++) {
    setTimeout(() => launchDanmu(), i * 200);
  }

  if (nextStage <= 4) {
    showStage(nextStage);
  } else {
    showResult();
  }
}

function showResult() {
  showStage(5);
  document.getElementById('fakeClose').style.display = 'none';

  for (let i = 0; i < 60; i++) {
    setTimeout(() => createConfetti(), i * 50);
  }
  // 结果页弹幕爆发
  for (let i = 0; i < 20; i++) {
    setTimeout(() => launchDanmu(), i * 300);
  }
}

function fakeCloseClick() {
  fakeCloseCount++;
  const overlay = document.getElementById('shakeOverlay');
  document.body.classList.add('shaking');

  // 点假关闭也刷弹幕
  for (let i = 0; i < 3; i++) {
    setTimeout(() => launchDanmu(), i * 200);
  }

  const msgs = [
    '想跑？没门！博士哥说先完成测试！',
    '关不掉的哦~ 前端大佬写的代码 质量杠杠的',
    '你急了你急了 九炸姐急了 哈哈哈',
    '这个按钮是假的 惊不惊喜 博士哥友情赞助',
    '越点越关不掉哦~ 前端大佬带你飞',
    '投降吧 完成测试才能获得自由',
    '你已经尝试关闭 ' + fakeCloseCount + ' 次了 博士哥都看不下去了',
    '提示: 完成测试 = 获得自由 九炸姐加油',
  ];
  const msg = msgs[Math.min(fakeCloseCount - 1, msgs.length - 1)];

  overlay.style.display = 'block';
  overlay.style.background = 'rgba(0,0,0,0.7)';
  overlay.innerHTML = '<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:white;text-align:center;font-size:16px;padding:20px;"><div style="font-size:40px;margin-bottom:15px;">&#x1F645;</div>' + msg + '</div>';

  setTimeout(() => {
    document.body.classList.remove('shaking');
    overlay.style.display = 'none';
    overlay.innerHTML = '';
  }, 2000);
}

function realClose() {
  if (navigator.vibrate) navigator.vibrate([100, 50, 100]);

  // 停掉弹幕循环
  if (danmuTimer) { clearInterval(danmuTimer); danmuTimer = null; }

  const overlay = document.getElementById('shakeOverlay');
  overlay.style.display = 'block';
  overlay.style.background = 'rgba(0,0,0,0.85)';
  overlay.innerHTML = `
    <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:white;text-align:center;padding:30px;">
      <div style="font-size:60px;margin-bottom:15px;">&#x1F389;&#x1F973;&#x1F389;</div>
      <div style="font-size:20px;font-weight:bold;margin-bottom:10px;">恭喜你正式获得</div>
      <div style="font-size:28px;color:#feca57;font-weight:bold;margin-bottom:15px;">「九炸姐」认证</div>
      <div style="font-size:14px;color:#ccc;margin-bottom:20px;">该称号有效期: 永久<br>撤销方式: 无<br>博士哥 & 前端大佬 联合认证</div>
      <div style="font-size:12px;color:#888;">页面将在 <span id="countdown">3</span> 秒后关闭...</div>
    </div>
  `;

  let count = 3;
  const timer = setInterval(() => {
    count--;
    const el = document.getElementById('countdown');
    if (el) el.textContent = count;
    if (count <= 0) {
      clearInterval(timer);
      overlay.innerHTML = `
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:white;text-align:center;padding:30px;">
          <div style="font-size:60px;margin-bottom:15px;">&#x1F92A;</div>
          <div style="font-size:18px;margin-bottom:15px;">骗你的~ 关不掉~</div>
          <div style="font-size:14px;color:#ccc;margin-bottom:20px;">博士哥说再看你挣扎一会儿 &#x1F923;</div>
          <button onclick="actuallyClose()" style="background:#feca57;color:#333;border:none;padding:12px 30px;border-radius:20px;font-size:15px;cursor:pointer;">好吧 真的关闭</button>
        </div>
      `;
    }
  }, 1000);
}

function actuallyClose() {
  document.getElementById('shakeOverlay').style.display = 'none';
  document.body.innerHTML = `
    <div style="display:flex;align-items:center;justify-content:center;min-height:100vh;background:#f0f0f0;text-align:center;padding:20px;">
      <div>
        <div style="font-size:60px;margin-bottom:20px;">&#x1F607;</div>
        <div style="font-size:20px;color:#333;font-weight:bold;margin-bottom:10px;">测试结束~</div>
        <div style="font-size:14px;color:#999;line-height:1.8;">
          哈哈哈开个玩笑啦<br>
          你永远是最棒的九炸姐 &#x2764;&#xFE0F;<br>
          博士哥 & 前端大佬 带你飞!<br><br>
          <span style="font-size:12px;color:#ccc;">（可以关闭页面了）</span>
        </div>
      </div>
    </div>
  `;
}

function launchDanmu() {
  const d = document.createElement('div');
  d.className = 'danmu';
  d.textContent = danmuTexts[Math.floor(Math.random() * danmuTexts.length)];
  d.style.top = (Math.random() * 70 + 5) + '%';
  d.style.right = '-400px';
  d.style.fontSize = (13 + Math.random() * 8) + 'px';
  const colors = [
    '#ff6b6b', '#feca57', '#48dbfb', '#ff9ff3', '#00d2d3',
    '#54a0ff', '#5f27cd', '#01a3a4', '#ff9f43', '#ee5a24',
    '#ffffff', '#f368e0', '#0abde3', '#10ac84', '#ee5a24',
  ];
  d.style.color = colors[Math.floor(Math.random() * colors.length)];
  document.body.appendChild(d);

  const duration = 3000 + Math.random() * 3000;
  d.style.transition = `right ${duration}ms linear`;
  requestAnimationFrame(() => {
    d.style.right = (window.innerWidth + 400) + 'px';
  });
  setTimeout(() => d.remove(), duration + 100);
}

function createConfetti() {
  const c = document.createElement('div');
  c.className = 'confetti';
  c.style.left = Math.random() * 100 + '%';
  c.style.top = '-10px';
  c.style.background = `hsl(${Math.random()*360}, 80%, 60%)`;
  c.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
  c.style.width = (5 + Math.random() * 10) + 'px';
  c.style.height = (5 + Math.random() * 10) + 'px';
  document.body.appendChild(c);
  setTimeout(() => c.remove(), 3000);
}

window.onbeforeunload = function(e) {
  if (currentStage > 0 && currentStage < 5) {
    e.preventDefault();
    e.returnValue = '九炸姐你要跑？测试还没做完呢！';
    return '九炸姐你要跑？测试还没做完呢！';
  }
};

document.addEventListener('contextmenu', e => e.preventDefault());
</script>
</body>
</html>
